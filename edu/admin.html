<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lumera Admin</title>

  <style>
    *{box-sizing:border-box}html,body{margin:0;padding:0;font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif;background:#f6f7f8;color:#111}
    a{color:inherit} .container{max-width:1100px;margin:0 auto;padding:24px}
    .topbar{position:sticky;top:0;background:#fff;border-bottom:1px solid #e6e7e8}
    .topbar .inner{display:flex;gap:12px;align-items:center;padding:12px 24px}
    .logo{width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,#f59e0b,#10b981);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800}
    .nav{margin-left:auto;display:flex;gap:8px;align-items:center}
    .btn{padding:8px 12px;border:1px solid #d0d2d4;border-radius:10px;background:#fff;cursor:pointer}
    .btn.primary{background:#111;color:#fff;border-color:#111}
    .badge{font-size:12px;padding:2px 8px;border-radius:999px;background:#f1f3f5;color:#222;border:1px solid #e6e7e8}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
    .card{background:#fff;border:1px solid #e6e7e8;border-radius:16px;overflow:hidden;box-shadow:0 1px 4px rgba(0,0,0,.04)}
    .card .media{height:140px;background:#eee;background-size:cover;background-position:center}
    .card .body{padding:12px 14px}
    .progress{height:8px;background:#eceff1;border-radius:999px;overflow:hidden}
    .progress > div{height:100%;background:#10b981}
    .small{font-size:12px;color:#555}
    footer{border-top:1px solid #e6e7e8;padding:32px;margin-top:48px;color:#555}
    .access{max-width:560px;border:1px solid #e6e7e8;border-radius:16px;padding:16px;background:#fff}
    .mono{font-family:ui-monospace,Consolas,Menlo,monospace}
  </style>

</head>
<body>
  <div id="app"></div>
  <div id="content"></div>
  <script>

    // --- auth helpers (front-end only) ---
    const ACCESS_KEYS = [
      { id: "admin-demo", role: "admin",  key: "LUMERA-ADMIN-KEY-EXAMPLE" },
      { id: "author-demo", role: "author", key: "LUMERA-AUTHOR-KEY-EXAMPLE" }
    ];
    function getAuth(){ try{ return JSON.parse(localStorage.getItem("lumera.auth")) || {role:"viewer"} }catch{ return {role:"viewer"} } }
    function setAuth(a){ localStorage.setItem("lumera.auth", JSON.stringify(a)); }
    function promptLogin(){
      const k = prompt("Enter your Lumera user key:"); if(!k) return getAuth();
      const f = ACCESS_KEYS.find(x => x.key === k.trim());
      if(f){ const next = { role:f.role, keyId:f.id }; setAuth(next); alert("Signed in as "+f.role); return next; }
      alert("Invalid key"); return getAuth();
    }
    // URL login (?key=...)
    (function(){ try{
      const p=new URLSearchParams(location.search); const k=p.get("key");
      if(k){ const f=ACCESS_KEYS.find(x=>x.key===k.trim()); if(f){ setAuth({role:f.role,keyId:f.id}); }
        history.replaceState({}, document.title, location.pathname);
      }
    }catch{} })();

    // --- tiny DOM helper ---
    function h(tag, attrs={}, ...children){
      const el=document.createElement(tag);
      for(const k in attrs){ const v=attrs[k];
        if(k==="class") el.className=v;
        else if(k==="style"&&typeof v==="object") Object.assign(el.style,v);
        else if(k.startsWith("on")&&typeof v==="function") el.addEventListener(k.slice(2).toLowerCase(), v);
        else el.setAttribute(k,v);
      }
      children.flat().forEach(c=>el.append(c instanceof Node?c:document.createTextNode(c)));
      return el;
    }

    // --- fixed topbar (prevents 'nullnull') ---
    function topbar(titleText, showStudio, showAdmin){
      const auth = getAuth();
      const roleLabel = auth && auth.role ? auth.role : "viewer";

      const navButtons = [
        h("span", { class: "small" }, "Role: " + roleLabel),
        roleLabel === "viewer"
          ? h("button", { class:"btn", onClick:()=>{ promptLogin(); location.reload(); } }, "Sign in")
          : h("button", { class:"btn", onClick:()=>{ if(confirm("Sign out?")){ setAuth({role:"viewer"}); location.reload(); } } }, "Sign out")
      ];

      return h("div",{class:"topbar"},
        h("div",{class:"inner"},
          h("div",{class:"logo"},"L"),
          h("strong",{}, titleText || "Lumera Education Portal"),
          h("div",{style:{flex:1}}),
          h("a",{class:"btn",href:"index.html"},"Catalog"),
          ((roleLabel==="author"||roleLabel==="admin") && showStudio) ? h("a",{class:"btn",href:"studio.html"},"Studio") : null,
          (roleLabel==="admin" && showAdmin) ? h("a",{class:"btn",href:"admin.html"},"Admin") : null,
          h("div",{class:"nav"}, ...navButtons)
        )
      );
    }

    function getAuth(){ try{ return JSON.parse(localStorage.getItem("lumera.auth")) || {role:"viewer"} }catch{ return {role:"viewer"} } }
    function getCourses(){ try{const v=localStorage.getItem("lumera.courses"); if(v) return JSON.parse(v);}catch{} return []; }

    function guardAdmin(){ const role=getAuth().role; if(role==="admin") return true;
      const c=document.getElementById("content"); c.innerHTML="";
      c.append(
        h("div",{class:"container"},
          h("div",{class:"access"},
            h("h3",{},"Access denied"),
            h("p",{class:"small"},"You need admin access. Use a user key to sign in."),
            h("button",{class:"btn",onClick:()=>{ promptLogin(); location.reload(); }},"Sign in")
          )
        )
      );
      return false;
    }

    function renderAdmin(){ const courses=getCourses(); const c=document.getElementById("content"); c.innerHTML="";
      c.append(
        h("div",{class:"container"},
          h("h2",{},"Admin"),
          h("p",{class:"small"},"Read-only overview for now."),
          h("pre",{class:"mono",style:"white-space:pre-wrap;background:#fafafa;border:1px solid #e6e7e8;padding:12px;border-radius:12px"}, JSON.stringify({courseCount:courses.length}, null, 2))
        )
      );
    }

    function boot(){ document.getElementById("app").append(topbar("Lumera Admin", true, true)); if(guardAdmin()) renderAdmin(); }
    document.addEventListener("DOMContentLoaded", boot);
  </script>
</body>
</html>
