<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Registry — State of Lumera</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="Official website of the e-State of Lumera. Constitution, Gazette, Ministries, Citizenship, Archives.">
  <link rel="icon" href="/assets/img/seal.svg">
  <link rel="stylesheet" href="/assets/css/style.css">
  <style>
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef2ff}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
  </style>
</head>
<body>
<header class="hero">
  <div class="hero-inner">
    <img class="seal" src="/assets/img/seal.svg" alt="Seal of Lumera">
    <h1>Official State Portal of Lumera</h1>
    <p class="motto">Truth • Virtue • Liberty • Prosperity</p>
    <nav class="nav">
      <a href="/">Home</a>
      <a href="/constitution/">Constitution</a>
      <a href="/gazette/">Gazette</a>
      <a href="/ministries/">Ministries</a>
      <a href="/citizenship/">Citizenship</a>
      <a href="/registry/">Registry</a>
      <a href="/projects/">Projects</a>
      <a href="/archives/">Archives</a>
      <a href="/tribes/">Tribes</a>
      <a href="/edu/index.html">Education Portal</a>
      <a href="/contact/">Contact</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <h2>Civil Registry (Public)</h2>
  <p class="kicker">Public listing shows Lumerian name, Citizen ID, and Tribe membership.</p>
  <table id="reg-table">
    <thead>
      <tr>
        <th>Lumerian Name</th>
        <th>Citizen ID</th>
        <th>Tribes</th>
        <th>Date Admitted</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</main>

<footer class="footer">© Lumera 2025 • Official State Portal</footer>

<script>
async function j(url){ const r=await fetch(url); return r.json(); }

Promise.all([
  j('/registry/registry.json'), // citizens list
  j('/registry/tribes.json')    // tribes membership
]).then(([citizensArr, tribesDoc])=>{
  // Build map CitizenID -> array of tribe codes
  const belongs = {};
  for(const code of Object.keys(tribesDoc.tribes)){
    for(const id of (tribesDoc.tribes[code].members||[])){
      (belongs[id] ||= []).push(code);
    }
  }

  const tb = document.querySelector('#reg-table tbody');
  tb.innerHTML = citizensArr.sort((a,b)=>a.id.localeCompare(b.id)).map(r=>`
    <tr>
      <td>${r.name}</td>
      <td class="mono">${r.id}</td>
      <td>${(belongs[r.id]||[]).map(t=>`<span class="pill mono">${t}</span>`).join(' ')}</td>
      <td>${r.date||''}</td>
    </tr>
  `).join('');
}).catch(err=>{
  document.querySelector('#reg-table tbody').innerHTML =
    `<tr><td colspan="4">Error loading registry: ${err.message}</td></tr>`;
});
</script>
</body>
</html>
