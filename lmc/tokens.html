<!-- Buy LMC Widget -->
<div class="buy-lmc-widget" style="font-family: sans-serif; padding: 2rem; max-width: 400px; margin: auto; border: 1px solid #ccc; border-radius: 12px;">
  <img src="https://black-neat-trout-951.mypinata.cloud/ipfs/bafkreieph36vzjcyqz7qs2dwsi3qrypg3r4srcv3nhsc6r2ajg5pilyn6i" alt="Lumera Coin Logo" style="max-width: 100px; display: block; margin: 0 auto 1rem auto;">
  <h2 style="text-align: center;">Buy Lumera Coin (LMC)</h2>
  <p style="text-align: center;">Powered by Phantom Wallet</p>

  <label for="amount" style="display: block; margin-top: 1rem;">Select Amount:</label>
  <select id="amount" style="width: 100%; padding: 0.5rem;">
    <option value="1">1 LMC</option>
    <option value="10">10 LMC</option>
    <option value="50">50 LMC</option>
    <option value="100">100 LMC</option>
  </select>

  <button id="buyLMC" style="margin-top: 1rem; width: 100%; padding: 0.75rem; background-color: #3b82f6; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
    Connect Wallet to Buy
  </button>

  <div id="status" style="margin-top: 1rem; text-align: center;"></div>
</div>

<script type="module">
  import { Connection, PublicKey, clusterApiUrl, Transaction, SystemProgram } from "https://cdn.jsdelivr.net/npm/@solana/web3.js/+esm";

  const treasuryWallet = new PublicKey("23iGqnDQQeTHqxbrXt5N1pbVXZxCvJdn52KHQrkng97r");
  const cluster = "https://api.mainnet-beta.solana.com";
  const connection = new Connection(cluster, "confirmed");

  const button = document.getElementById("buyLMC");
  const status = document.getElementById("status");

  let provider = window.phantom?.solana;
  let buyerPublicKey = null;

  async function getSolEquivalent(lmcAmount) {
    const gbpToUsd = 1.21; // 1 GBP = 1.21 USD
    const lmcPriceUsd = 1.00; // 1 LMC = $1.00 USD
    const solUsdPrice = 30.00; // SOL price in USD (use live API if needed)

    const costInUsd = lmcAmount * lmcPriceUsd;
    const costInSol = costInUsd / solUsdPrice;
    return costInSol;
  }

  button.addEventListener("click", async () => {
    if (!provider?.isPhantom) {
      status.innerText = "Phantom Wallet not found.";
      return;
    }

    try {
      const resp = await provider.connect();
      buyerPublicKey = new PublicKey(resp.publicKey);

      const amount = parseInt(document.getElementById("amount").value);
      const solAmount = await getSolEquivalent(amount);
      const lamports = Math.floor(solAmount * 1e9);

      const transaction = new Transaction().add(
        SystemProgram.transfer({
          fromPubkey: buyerPublicKey,
          toPubkey: treasuryWallet,
          lamports
        })
      );

      transaction.feePayer = buyerPublicKey;
      const { blockhash } = await connection.getRecentBlockhash();
      transaction.recentBlockhash = blockhash;

      const signed = await provider.signTransaction(transaction);
      const signature = await connection.sendRawTransaction(signed.serialize());

      status.innerHTML = `<p style="color: green;">Success! <a target="_blank" href='https://explorer.solana.com/tx/${signature}?cluster=mainnet-beta'>View Transaction</a></p>`;
    } catch (err) {
      console.error(err);
      status.innerHTML = `<p style="color: red;">Transaction failed: ${err.message}</p>`;
    }
  });
</script>
