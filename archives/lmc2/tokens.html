<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buy LMC - Lumera</title>
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.75.0/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/wallet-adapter-wallets@0.10.3/lib/index.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/wallet-adapter-base@0.10.3/lib/index.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/wallet-adapter-react-ui@0.10.3/lib/index.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/wallet-adapter-react@0.10.3/lib/index.umd.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@solana/wallet-adapter-react-ui/styles.css">
</head>
<body>
  <h1>Buy Lumera Coin (LMC)</h1>
  <div>
    <button id="connectWallet">Connect Wallet</button>
    <p id="walletStatus">Wallet not connected</p>
  </div>
  <form id="buyForm">
    <label for="lmcAmount">Amount of LMC to buy:</label>
    <input type="number" id="lmcAmount" name="lmcAmount" min="1" step="1" required>
    <p id="solAmount">Equivalent in SOL: 0</p>
    <button type="submit">Buy</button>
  </form>
  <p id="status"></p>
  <script>
    const treasuryWallet = "23iGqnDQQeTHqxbrXt5N1pbVXZxCvJdn52KHQrkng97r";
    const rate = 0.001; // 1 LMC = 0.001 SOL
    const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('mainnet-beta'));

    let provider = null;

    window.onload = () => {
      document.getElementById("connectWallet").onclick = async () => {
        try {
          const resp = await window.solana.connect();
          provider = window.solana;
          document.getElementById("walletStatus").innerText = `Wallet connected: ${provider.publicKey.toString()}`;
        } catch (err) {
          console.error(err);
          document.getElementById("walletStatus").innerText = "Wallet connection failed.";
        }
      };

      document.getElementById("lmcAmount").oninput = (e) => {
        const amount = parseFloat(e.target.value) || 0;
        document.getElementById("solAmount").innerText = `Equivalent in SOL: ${(amount * rate).toFixed(6)}`;
      };

      document.getElementById("buyForm").onsubmit = async (e) => {
        e.preventDefault();
        if (!provider || !provider.publicKey) {
          document.getElementById("status").innerText = "Please connect your wallet first.";
          return;
        }

        const lmcAmount = parseFloat(document.getElementById("lmcAmount").value);
        const solAmount = lmcAmount * rate;

        const transaction = new solanaWeb3.Transaction().add(
          solanaWeb3.SystemProgram.transfer({
            fromPubkey: provider.publicKey,
            toPubkey: new solanaWeb3.PublicKey(treasuryWallet),
            lamports: solanaWeb3.LAMPORTS_PER_SOL * solAmount,
          })
        );

        try {
          const { blockhash } = await connection.getRecentBlockhash();
          transaction.recentBlockhash = blockhash;
          transaction.feePayer = provider.publicKey;
          const signed = await provider.signTransaction(transaction);
          const txid = await connection.sendRawTransaction(signed.serialize());
          document.getElementById("status").innerText = `Transaction sent! TXID: ${txid}`;
        } catch (err) {
          console.error(err);
          document.getElementById("status").innerText = `Error: ${err.message}`;
        }
      };
    };
  </script>
</body>
</html>
